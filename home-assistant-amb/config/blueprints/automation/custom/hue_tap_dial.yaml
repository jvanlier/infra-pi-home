blueprint:
  name: Hue Tap Dial for Zigbee2MQTT
  description: >
    Simple implementation for Hue Tap Dial for Zigbee2MQTT.
  domain: automation

  input:
    controller:
      name: (Zigbee2MQTT) Controller Name
      description: The name of the device in Zigbee2MQTT
      default: ""
    base_topic:
      name: Root/Base mqtt topic from Zigbee2MQTT
      description: The Root/base topic as configured in Zigbee2MQTT
      default: zigbee2mqtt

    button_1_press:
      name: Button 1 press
      description: Action for button 1 press
      default: []
      selector:
        action: {}
    button_2_press:
      name: Button 2 press
      description: Action for button 2 press
      default: []
      selector:
        action: {}
    button_3_press:
      name: Button 3 press
      description: Action for button 3 press
      default: []
      selector:
        action: {}
    button_4_press:
      name: Button 4 press
      description: Action for button 4 press
      default: []
      selector:
        action: {}
    dial_rotate_left_step:
      name: Dial rotate left step
      description: Action for dial rotate left step
      default: []
      selector:
        action: {}
    dial_rotate_left_slow:
      name: Dial rotate left slow
      description: Action for dial rotate left slow
      default: []
      selector:
        action: {}
    dial_rotate_left_fast:
      name: Dial rotate left fast
      description: Action for dial rotate left fast
      default: []
      selector:
        action: {}
    dial_rotate_right_step:
      name: Dial rotate right step
      description: Action for dial rotate right step
      default: []
      selector:
        action: {}
    dial_rotate_right_slow:
      name: Dial rotate right slow
      description: Action for dial rotate right slow
      default: []
      selector:
        action: {}
    dial_rotate_right_fast:
      name: Dial rotate right fast
      description: Action for dial rotate right fast
      default: []
      selector:
        action: {}

mode: restart

trigger_variables:
  base_topic: !input base_topic
  controller: !input controller

trigger:
  - platform: mqtt
    topic: "{{ base_topic ~ '/' ~ controller }}"

condition:
  - condition: template
    value_template: "{{ 'action' in trigger.payload_json and trigger.payload_json.action != '' }}"

action:
  - variables:
      controller: !input controller
      command: "{{ trigger.payload_json.action }}"
  - choose:
      # Not implemented: press_release, hold, hold_release,
      - conditions: '{{ command == "button_1_press" }}'
        sequence: !input button_1_press
      - conditions: '{{ command == "button_2_press" }}'
        sequence: !input button_2_press
      - conditions: '{{ command == "button_3_press" }}'
        sequence: !input button_3_press
      - conditions: '{{ command == "button_4_press" }}'
        sequence: !input button_4_press
      - conditions: '{{ command == "dial_rotate_left_step" }}'
        sequence: !input dial_rotate_left_step
      - conditions: '{{ command == "dial_rotate_left_slow" }}'
        sequence: !input dial_rotate_left_slow
      - conditions: '{{ command == "dial_rotate_left_fast" }}'
        sequence: !input dial_rotate_left_fast
      - conditions: '{{ command == "dial_rotate_right_step" }}'
        sequence: !input dial_rotate_right_step
      - conditions: '{{ command == "dial_rotate_right_slow" }}'
        sequence: !input dial_rotate_right_slow
      - conditions: '{{ command == "dial_rotate_right_fast" }}'
        sequence: !input dial_rotate_right_fast
