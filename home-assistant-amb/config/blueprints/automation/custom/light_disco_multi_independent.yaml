blueprint:
  name: Light Disco Multi Independent
  description: >
    Disco mode that cycles multiple individual lights independently,
    each with its own random timing. Unlike the standard disco blueprint
    which uses a single Zigbee group, this controls each light separately
    for more varied visual effects.

  domain: automation

  input:
    light_entities:
      name: Color lights
      description: >
        List of individual color lights to cycle independently.
      selector:
        entity:
          domain: light
          multiple: true

    input_boolean_disco:
      name: Input boolean for disco
      description: >
        Input boolean for disco toggle.
      selector:
        entity:
          domain: input_boolean
          multiple: false

mode: restart

trigger:
  - platform: state
    entity_id: !input input_boolean_disco
    to: "on"

action:
  - variables:
      input_boolean_entity: !input input_boolean_disco
      light_entities: !input light_entities
  # Start a parallel sequence for each light - each runs independently
  - parallel:
      - repeat:
          while:
            - condition: template
              value_template: "{{ states(input_boolean_entity) == 'on' }}"
          sequence:
            - service: light.turn_on
              data:
                rgb_color:
                  - "{{ range(0, 255) | random }}"
                  - "{{ range(0, 255) | random }}"
                  - "{{ range(0, 255) | random }}"
              target:
                entity_id: "{{ light_entities[0] }}"
            - delay:
                seconds: "{{ range(1, 4) | random }}"
      - repeat:
          while:
            - condition: template
              value_template: "{{ states(input_boolean_entity) == 'on' }}"
          sequence:
            - service: light.turn_on
              data:
                rgb_color:
                  - "{{ range(0, 255) | random }}"
                  - "{{ range(0, 255) | random }}"
                  - "{{ range(0, 255) | random }}"
              target:
                entity_id: "{{ light_entities[1] }}"
            - delay:
                seconds: "{{ range(1, 4) | random }}"
      - repeat:
          while:
            - condition: template
              value_template: "{{ states(input_boolean_entity) == 'on' }}"
          sequence:
            - service: light.turn_on
              data:
                rgb_color:
                  - "{{ range(0, 255) | random }}"
                  - "{{ range(0, 255) | random }}"
                  - "{{ range(0, 255) | random }}"
              target:
                entity_id: "{{ light_entities[2] }}"
            - delay:
                seconds: "{{ range(1, 4) | random }}"
      - repeat:
          while:
            - condition: template
              value_template: "{{ states(input_boolean_entity) == 'on' }}"
          sequence:
            - service: light.turn_on
              data:
                rgb_color:
                  - "{{ range(0, 255) | random }}"
                  - "{{ range(0, 255) | random }}"
                  - "{{ range(0, 255) | random }}"
              target:
                entity_id: "{{ light_entities[3] }}"
            - delay:
                seconds: "{{ range(1, 4) | random }}"
