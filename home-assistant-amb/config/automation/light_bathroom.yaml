- alias: Motion-activated Light Bathroom
  id: mal-bathroom
  use_blueprint:
    path: custom/light_motion_activated_dark_aware.yaml
    input:
      motion_entity: binary_sensor.motion_bathroom_occupancy
      device_no_motion_wait: number.motion_bathroom_detection_door_interval
      total_no_motion_wait: 300
      light_entity_id: light.light_bathroom
      adaptive_light_entity: switch.adaptive_lighting_bathroom
      adaptive_light_adapt_brightness_entity: switch.adaptive_lighting_adapt_brightness_bathroom

- alias: "Presence activated light bathroom: off"
  id: presence-activated-light-bathroom-off
  trigger:
    - platform: state
      entity_id: binary_sensor.presence_ground_floor
      to: "off"
      # The presence sensor has a rather long delay_off, so we can safely toggle directly on a state change.
  action:
    - service: "light.turn_off"
      data:
        transition: 10
      target:
        # Turn off the motion-activated lights manually, in case they were in dimmed state:
        entity_id:
          - light.light_hall_0_wall
          - light.light_group_hall_0_spot
          - light.light_toilet
    # Splitting the lights with a short delay to prevent flooding the Zigbee network:
    - delay: "00:00:02"
    - service: "light.turn_off"
      data:
        transition: 8
      target:
        entity_id:
          - light.light_group_living_spot_always
          - light.light_group_living_spot_dark_outside
          - light.light_dining_table
